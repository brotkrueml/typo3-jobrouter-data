<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers" data-namespace-typo3-fluid="true">
    <f:render section="synchronisations" arguments="{_all}"/>
    <f:render section="transfers" arguments="{_all}"/>

    <f:section name="synchronisations">
        <h2>{f:translate(key:"LLL:EXT:jobrouter_data/Resources/Private/Language/Report.xlf:synchronisations")}</h2>
        <p>
            {f:translate(key:"LLL:EXT:jobrouter_data/Resources/Private/Language/Report.xlf:last_synchronisation")}:
            <f:render section="lastDate" arguments="{date: syncLastDate}"/>
        </p>

        <table class="table table-striped table-hover table-vertical-top">
            <tbody>
                <f:for each="{syncTablesByType}" key="type" as="tables">
                    <tr>
                        <td class="info col-xs-6">
                            <f:translate key="LLL:EXT:jobrouter_data/Resources/Private/Language/Report.xlf:active_sync_tables.{type}"/>
                        </td>
                        <td class="info col-xs-6">{tables.totalActive}</td>
                    </tr>
                    <f:if condition="{tables.erroneous}">
                        <td class="danger col-xs-6">
                            &nbsp;&nbsp;&nbsp; <f:translate key="LLL:EXT:jobrouter_data/Resources/Private/Language/Report.xlf:with_errors"/>
                        </td>
                        <td class="danger col-xs-6">
                            <f:for each="{tables.erroneous}" as="table">
                                {table.name} (<span title="{table.lastSyncError}">{table.lastSyncError -> f:format.crop(maxCharacters: 100)}</span>)<br>
                            </f:for>
                        </td>
                    </f:if>
                </f:for>
            </tbody>
        </table>
    </f:section>

    <f:section name="transfers">
        <h2>{f:translate(key:"LLL:EXT:jobrouter_data/Resources/Private/Language/Report.xlf:transfers")}</h2>
        <p>
            {f:translate(key:"LLL:EXT:jobrouter_data/Resources/Private/Language/Report.xlf:last_transmission")}:
            <f:render section="lastDate" arguments="{date: transferLastTransmitDate}"/>
        </p>
        <table class="table table-striped table-hover table-vertical-top">
            <tbody>
                <tr>
                    <td class="info col-xs-6">
                        {f:translate(key:"LLL:EXT:jobrouter_data/Resources/Private/Language/Report.xlf:total_transfers")}
                        <f:if condition="{transferFirstTransmitDate}">
                            {f:translate(key:"LLL:EXT:jobrouter_data/Resources/Private/Language/Report.xlf:since")}
                            {transferFirstTransmitDate -> f:format.date(format: '{settings.dateFormat} {settings.timeFormat}')}
                        </f:if>
                    </td>
                    <td class="info col-xs-6">{transferTotal}</td>
                </tr>
                <f:if condition="{transferTransmitSuccess}">
                    <tr>
                        <td class="success col-xs-6">
                            &nbsp;&nbsp;&nbsp; {f:translate(key:"LLL:EXT:jobrouter_data/Resources/Private/Language/Report.xlf:transmissions_successful")}
                        </td>
                        <td class="success col-xs-6">{transferTransmitSuccess}</td>
                    </tr>
                </f:if>
                <f:if condition="{transferInQueue}">
                    <tr>
                        <td class="info col-xs-6">
                            &nbsp;&nbsp;&nbsp; {f:translate(key:"LLL:EXT:jobrouter_data/Resources/Private/Language/Report.xlf:transmissions_in_queue")}
                        </td>
                        <td class="info col-xs-6">{transferInQueue}</td>
                    </tr>
                </f:if>
                <f:if condition="{transferTransmitErroneous}">
                    <tr>
                        <td class="danger col-xs-6">
                            &nbsp;&nbsp;&nbsp; {f:translate(key:"LLL:EXT:jobrouter_data/Resources/Private/Language/Report.xlf:transmissions_erroneous")}
                        </td>
                        <td class="danger col-xs-6">{transferTransmitErroneous}</td>
                    </tr>
                </f:if>
            </tbody>
        </table>
    </f:section>

    <f:section name="lastDate">
        <f:if condition="{date}">
            <f:then>
                {date -> f:format.date(format: '{settings.dateFormat} {settings.timeFormat}')}
            </f:then>
            <f:else>
                <f:translate key="LLL:EXT:jobrouter_data/Resources/Private/Language/Report.xlf:never_run"/>
            </f:else>
        </f:if>
    </f:section>
</html>
